package priv.hkon.theseq.sprites;

import priv.hkon.theseq.blocks.Tree;
import priv.hkon.theseq.world.House;
import priv.hkon.theseq.world.Tile;
import priv.hkon.theseq.world.Village;

public class Gardener extends Villager {
	boolean isPlanting = false;

	public Gardener(int x, int y, Village v, House h, int i) {
		super(x, y, v, h, i);
		// TODO Auto-generated constructor stub
		targetMode  = MODE_WORKING;
	}
	
	public boolean tick(){
		if(super.tick()){
			return true;
		}
		
		return false;
	}
	
	public void work(){
		if(isPlanting){
			plantPlant();
			return;
		}
		
		if(RAND.nextInt(10000) == 0){
			for(int i = 0; i < fovDeltaCoordinates[movingDirection].length; i++){
				int nx = x + fovDeltaCoordinates[movingDirection][i][0];
				int ny = y + fovDeltaCoordinates[movingDirection][i][1];
				if(village.getTileAt(nx, ny) == Tile.TYPE_GRASS
						&& village.getSpriteAt(nx, ny) == null
						&& village.ownedBy(nx, ny) == null){
					pauseMode();
					isPlanting = true;
					targetX = nx;
					targetY = ny;
					
					return;
				}
			}
		}
		if(!hasPath){
			strollTownGrid();
		}
	}
	
	public void plantPlant(){
		if( distTo(targetX, targetY)== 1){
			turnTowards(getDirectionTo(targetX, targetY));
			if(village.getSpriteAt(targetX, targetY) == null){
				Tree t = new Tree(targetX, targetY, village);
				village.setTileAt(t, targetX, targetY);
			}
			setDialogString("Aaah, that's better!");
			showDialog(2*60);
		}
	}
	
	

}
